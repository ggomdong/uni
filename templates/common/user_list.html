{% extends 'base.html' %}
{% load pybo_filter %}
{% load static %}
{% block content %}

<div class="container my-3">
<form id="searchForm" method="get" action="{% url 'common:user_list' %}">
{% csrf_token %}
    <div>
    <table class="main table sticky-top">
        <thead>
        <tr>
            <th colspan="100%">
                <div class="row my-3">
                    <div class="col-2">
                        <select class="form-select" name="work" id="work">
                            <option value="ì „ì²´" {% if search_work == 'ì „ì²´' %} selected {% endif %}>ì „ì²´(ì¬ì§ì—¬ë¶€)</option>
                            <option value="ì¬ì§ì" {% if search_work == 'ì¬ì§ì' %} selected {% endif %}>ì¬ì§ì</option>
                            <option value="í‡´ì‚¬ì" {% if search_work == 'í‡´ì‚¬ì' %} selected {% endif %}>í‡´ì‚¬ì</option>
                        </select>
                    </div>
                    <div class="col-2">
                        <select class="form-select" name="dept" id="dept">
                            <option value="ì „ì²´" {% if search_dept == 'ì „ì²´' %} selected {% endif %}>ì „ì²´(ë¶€ì„œ)</option>
                            {% for dept in dept_list %}
                            <option value="{{dept}}" {% if search_dept == dept %} selected {% endif %}>{{dept}}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-2">
                        <select class="form-select" name="position" id="position">
                            <option value="ì „ì²´" {% if search_position == 'ì „ì²´' %} selected {% endif %}>ì „ì²´(ì§ìœ„)</option>
                            {% for position in position_list %}
                            <option value="{{position}}" {% if search_position == position %} selected {% endif %}>{{position}}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-6 text-end">
                        <a href="{% url 'common:signup' %}" class="btn btn-primary">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-fill-add" viewBox="0 0 16 16">
                              <path d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Zm.5-5v1h1a.5.5 0 0 1 0 1h-1v1a.5.5 0 0 1-1 0v-1h-1a.5.5 0 0 1 0-1h1v-1a.5.5 0 0 1 1 0Zm-2-6a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"/>
                              <path d="M2 13c0 1 1 1 1 1h5.256A4.493 4.493 0 0 1 8 12.5a4.49 4.49 0 0 1 1.544-3.393C9.077 9.038 8.564 9 8 9c-5 0-6 3-6 4Z"/>
                            </svg>
                            ì§ì› ë“±ë¡
                        </a>
                    </div>
                </div>
            </th>
        </tr>
        <tr class="text-center">
            <th class="table-primary" colspan="6">ê¸°ë³¸ì •ë³´</th>
            <th class="table-secondary" colspan="12">ê·¼ë¡œê³„ì•½</th>
        </tr>
        <tr class="text-center">
            <input type="hidden" id="order" name="order" value="{{order|default_if_none:'0'}}">
            <th class="table-primary">ë²ˆí˜¸</th>
            <th class="table-primary sortable" onClick="sort(1)">ì„±ëª… {% if order == '1' %}â–²{% elif order == '11' %}â–¼{% else %}â†•{% endif %}</th>
            <th class="table-primary sortable" onClick="sort(0)">ë¶€ì„œ {% if order == '0' %}â–²{% elif order == '01' %}â–¼{% else %}â†•{% endif %}</th>
            <th class="table-primary">ì§ìœ„</th>
            <th class="table-primary sortable" onClick="sort(2)">ì…ì‚¬ì¼ {% if order == '2' %}â–²{% elif order == '21' %}â–¼{% else %}â†•{% endif %}</th>
            <th class="table-primary sortable" onClick="sort(3)">ìµœì¢…ê·¼ë¬´ì¼ {% if order == '3' %}â–²{% elif order == '31' %}â–¼{% else %}â†•{% endif %}</th>
<!--            <th class="table-primary" onClick="sortTable(0)">ë²ˆí˜¸</th>-->
<!--            <th class="table-primary" onClick="sortTable(1)">ì„±ëª…</th>-->
<!--            <th class="table-primary" onClick="sortTable(2)">ë¶€ì„œ</th>-->
<!--            <th class="table-primary" onClick="sortTable(3)">ì§ìœ„</th>-->
<!--            <th class="table-primary" onClick="sortTable(4)">ì…ì‚¬ì¼</th>-->
<!--            <th class="table-primary" onClick="sortTable(5)">ìµœì¢…ê·¼ë¬´ì¼</th>-->
            <th class="table-secondary">ê¸°ì¤€ì¼</th>
            <th class="table-secondary">ê·¼ë¬´í˜•íƒœ</th>
            <th class="table-secondary">ê·¼íƒœí™•ì¸</th>
            <th class="table-secondary">ì›”</th>
            <th class="table-secondary">í™”</th>
            <th class="table-secondary">ìˆ˜</th>
            <th class="table-secondary">ëª©</th>
            <th class="table-secondary">ê¸ˆ</th>
            <th class="table-secondary">í† </th>
            <th class="table-secondary">ì¼</th>
        </tr>
        </thead>
        <tbody>
        {% if user_list %}
        {% for user in user_list %}
        <tr class="text-center align-middle">
            <td>
                {{ forloop.counter }}
            </td>
            <td>
                <a href="{% url 'common:user_modify' user.id %}">{{ user.emp_name }}</a>
                <span style='cursor: pointer;' onclick="javascript:print_nametag('{{user.emp_name}}', '{{user.position}}');">ğŸ·ï¸</span>
<!--                <div name="nametag" style="cursor: pointer;" data-bs-toggle="modal" data-bs-target="#nametagModal"-->
<!--                data-name="{{ user.emp_name }}" data-position="{{ user.position }}">{{ user.position }}</div>-->
            </td>
            <td>{{ user.dept }}</td>
            <td>{{ user.position }}</td>
            <td>{{ user.join_date|date:'Y-m-d' }}</td>
            <td>{{ user.out_date|date:'Y-m-d' }}</td>
            <!-- ê³„ì•½ì´ ì—†ëŠ” ê²½ìš° user.cidê°€ Noneì´ë¯€ë¡œ NoReverseMatch ì˜¤ë¥˜ê°€ ë°œìƒí•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ê³„ì•½ìœ ë¬´ì— ë”°ë¼ ë¶„ê¸°ì²˜ë¦¬ -->
            <td>
              {% if user.cid %}
                <a href="{% url 'wtm:work_contract_modify' user.cid %}">
                  {{ user.stand_date|date:'Y-m-d' }}
                </a>
              {% else %}
                <a href="{% url 'wtm:work_contract_reg' user.id %}">
                  ê³„ì•½ë“±ë¡
                </a>
              {% endif %}
            </td>
            <td>{{ user.type|default_if_none:'' }}</td>
            <td>{{ user.check_yn|default_if_none:'' }}</td>

            {% for key, value in day_of_the_week.items %}
            <td align="center">
                <!-- user.keyë¡œ ì‚¬ìš©í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì—, index ê°’ì„ ê°€ì ¸ì˜¤ëŠ” filterë¥¼ í™œìš©í•´ì„œ keyì— ë§ëŠ” ê°’ì„ ì„¸íŒ… -->
                {% with user|get_index:key as module_id %}
                    {% for module in module_list %}
                    {% if module.id == module_id %}
                    <div class="module_box" style="background-color: {{ module_colors|get_index:module.color }};">
                        {% if module.cat == 'OFF' %}
                            -
                        {% else %}
                            {{ module.start_time }}
                            {{ module.end_time }}
                        {% endif %}
                    </div>
                    {% endif %}
                    {% endfor %}
                {% endwith %}
            </td>
            {% endfor %}
        </tr>
        {% endfor %}
        {% else %}
        <tr class="text-center">
            <td colspan="16">ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤.</td>
        </tr>
        {% endif %}
        </tbody>
    </table>
    </div>
</form>
</div>

<!-- Modal dialog -->
<!--<div class="modal fade" id="nametagModal" tabindex="-1" aria-labelledby="nametagModalLabel" aria-hidden="true">-->
<!--    <div class="modal-dialog modal-lg">-->
<!--        <div class="modal-content">-->
<!--            <div class="modal-header">-->
<!--                <h1 class="modal-title fs-5" id="nametagModalLabel">ëª…ì°° ì¶œë ¥</h1>-->
<!--                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>-->
<!--            </div>-->
<!--            <div class="modal-body">-->
<!--                <div class="nametag-parent">-->
<!--                    <div class="nametag-left"></div>-->
<!--                    <div class="nametag-main">-->
<!--                        <div class="left">-->
<!--                            <div><img src="{% static 'logo.png' %}" width="200" height="75"></div>-->
<!--                            <div><img src="{% static 'logo2.png' %}" width="150" height="22"></div>-->
<!--                        </div>-->
<!--                        <div class="right">-->
<!--                            <div id="nametag_position"></div>-->
<!--                            <div id="nametag_name"></div>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->
<!--            <div class="modal-footer">-->
<!--                <button type="button" class="print btn btn-primary">ì¸ì‡„</button>-->
<!--                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->
<!--</div>-->
{% endblock %}
{% block script %}
<script type="text/javascript">
const selectedWork = document.getElementById("work");
selectedWork.addEventListener('change', function() {
    document.getElementById('searchForm').submit();
});

const selectedDept = document.getElementById("dept");
selectedDept.addEventListener('change', function() {
    document.getElementById('searchForm').submit();
});

const selectedPosition = document.getElementById("position");
selectedPosition.addEventListener('change', function() {
    document.getElementById('searchForm').submit();
});

function sort(n) {
  const Order = document.getElementById("order");

  /* í˜„ì¬ ì •ë ¬ ê¸°ì¤€ì„ ë‹¤ì‹œ í´ë¦­í•˜ë©´ ì—­ìˆœ(desc)ìœ¼ë¡œ ì •ë ¬ì„ ìœ„í•´ ê°’ì„ ë³€ê²½ */
  if (Order.value == n) {
    Order.value = n+'1';
  } else {
    Order.value = n;
  }

  document.getElementById('searchForm').submit();
}

/*
const nametag_element = document.getElementsByName("nametag");
Array.from(nametag_element).forEach(function(element) {
  element.addEventListener('click', function() {
    document.getElementById('nametag_position').textContent = this.dataset.position;
    document.getElementById('nametag_name').textContent = this.dataset.name;
  });
});
*/

function print_nametag(emp_name, position) {
  let url = "{% url 'common:nametag' 'NAME' 'POSITION' %}";
  const name = "ëª…ì°° ì¶œë ¥"
  const option = "width=750, height=350, location=no, resizable=no";
  url = url.replace(/NAME/g, emp_name);
  url = url.replace(/POSITION/g, position);
  window.open(url, name, option);
  //location.href=url;
}

/* (ì‚¬ìš©X) WEB ìƒì—ì„œ ì •ë ¬í•˜ëŠ” javascriptë¡œì„œ, ë¶€ì„œëª… ê°€ë‚˜ë‹¤ìˆœì´ ì•„ë‹Œ ì¶œë ¥ìˆœì„œë¡œ ì •ë ¬í•˜ê¸°ê°€ ê¹Œë‹¤ë¡œì›Œì„œ ì‚¬ìš©í•˜ì§€ ì•Šì•˜ìŒ */
function sortTable(n) {
  var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
  table = document.getElementById("sortable");
  switching = true;
  // ì •ë ¬ë°©í–¥ì„ ì„¸íŒ… : ì˜¤ë¦„ì°¨ìˆœ
  dir = "asc";
  // ë” ì´ìƒ ì •ë ¬ì´ í•„ìš”ì—†ì„ë•Œê¹Œì§€ ë°˜ë³µ
  while (switching) {
    switching = false;
    rows = table.rows;
    // í—¤ë”ë¥¼ ì œì™¸í•œ(ê²€ìƒ‰/ê¸°ë³¸ì •ë³´/ë²ˆí˜¸ ë“± í—¤ë”ê°€ 3ê°œì„) ëª¨ë“  ì—´ì— ëŒ€í•´ ì •ë ¬ì„ ì‹œë„í•¨
    for (i = 3; i < (rows.length - 1); i++) {
      // ë³€ìˆ˜ ì´ˆê¸°í™”
      shouldSwitch = false;
      // í˜„ì¬ ì—´ê³¼ ë‹¤ìŒ ì—´ì˜ ê°’ì„ ê°€ì ¸ì˜´
      x = rows[i].getElementsByTagName("TD")[n];
      y = rows[i + 1].getElementsByTagName("TD")[n];
      // ì •ë ¬ í•„ìš” ì—¬ë¶€ ì²´í¬
      if (n == 0) {
          if (dir == "asc") {
            if (Number(x.innerText) > Number(y.innerText)) {
              // ì •ë ¬ì´ í•„ìš”í•˜ë©´ ì²´í¬í•˜ê³ , while íƒˆì¶œ
              shouldSwitch = true;
              break;
            }
          } else if (dir == "desc") {
            if (Number(x.innerText) < Number(y.innerText)) {
              // ì •ë ¬ì´ í•„ìš”í•˜ë©´ ì²´í¬í•˜ê³ , while íƒˆì¶œ
              shouldSwitch = true;
              break;
            }
          }
      } else {
          if (dir == "asc") {
            if (x.innerText.toLowerCase() > y.innerText.toLowerCase()) {
              // ì •ë ¬ì´ í•„ìš”í•˜ë©´ ì²´í¬í•˜ê³ , while íƒˆì¶œ
              shouldSwitch = true;
              break;
            }
          } else if (dir == "desc") {
            if (x.innerText.toLowerCase() < y.innerText.toLowerCase()) {
              // ì •ë ¬ì´ í•„ìš”í•˜ë©´ ì²´í¬í•˜ê³ , while íƒˆì¶œ
              shouldSwitch = true;
              break;
            }
          }
      }
    }
    if (shouldSwitch) {
      // êµí™˜ í›„ ì™„ë£Œë¡œ í‘œê¸°
      rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
      switching = true;
      // êµí™˜ ì™„ë£Œì‹œ ì¹´ìš´íŠ¸ 1 ì¦ê°€
      switchcount ++;
    } else {
      // êµí™˜ì´ ì¼ì–´ë‚˜ì§€ ì•Šì•˜ê³ , ì˜¤ë¦„ì°¨ìˆœì´ë©´(ì¦‰, ì´ë¯¸ ì˜¤ë¦„ì°¨ìˆœìœ¼ë¡œ ì •ë ¬ì„ í•œë²ˆ í–ˆë‹¤ë©´) -> ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ë°”ê¾¸ê³  whileë¬¸ ì¬ì‹¤í–‰
      if (switchcount == 0 && dir == "asc") {
        dir = "desc";
        switching = true;
      }
    }
  }
}
</script>
{% endblock %}