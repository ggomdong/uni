{% extends 'base.html' %}
{% load pybo_filter %}
{% block content %}
<form method="post">
<div class="container my-3">
    <div class="row my-3">
        <div class="col-10 text-bg-dark text-center">
            <h5>
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-caret-left-fill" viewBox="0 0 16 16">
                  <path d="m3.86 8.753 5.482 4.796c.646.566 1.658.106 1.658-.753V3.204a1 1 0 0 0-1.659-.753l-5.48 4.796a1 1 0 0 0 0 1.506z"/>
                </svg> &nbsp;&nbsp;
                {{ stand_ym|slice:"0:4" }}년 {{ stand_ym|slice:"5:6" }}월
                &nbsp;&nbsp;
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-caret-right-fill" viewBox="0 0 16 16">
                  <path d="m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"/>
                </svg>
            </h5>
        </div>
    </div>

    <div class="my-3">
    <table class="text-center">
        <tr>
            {% for module in module_list %}
            <td style="width: 50px;">
                <input type="radio" class="invisible-radio" name="module" id="{{module.id}}" value="{{module.id}}">
                <label class="form-label" for="{{module.id}}">
                    <div class="module_box" id="select{{module.id}}" style="background-color: {{ module_colors|get_index:module.color }};">
                        {% if module.cat == '휴일근무' %}
                        <font color="blue">
                            {{ module.start_time }}
                            {{ module.end_time }}
                        </font>
                        {% elif module.cat == '유급휴무' %}
                        {{ module.name|slice:"0:2" }}
                        {{ module.name|slice:"2:4" }}
                        {% elif module.cat == 'OFF' %}
                        -<br>
                        &nbsp;
                        {% else %}
                        {{ module.start_time }}
                        {{ module.end_time }}
                        {% endif %}
                    </div>
                </label>
            </td>
            {% endfor %}
        </tr>
        <tr style="font-size: 10px">
            {% for module in module_list %}
            <td>
                {{ module.name }}
            </td>
            {% endfor %}
        </tr>
    </table>
    </div>
    <hr>
    <div class="my-3">
    <table class="table text-center table-borderless table-sm">
        {% if day_list %}
        <tr>
            <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
            {% for key, value in day_list.items %}
            <td>
                {% if value == '일' %}
                <font color="red">
                {{ key }}
                </font>
                {% else %}
                {{ key }}
                {% endif %}
            </td>
            {% endfor %}
        </tr>
        <tr>
            <td></td>
            {% for key, value in day_list.items %}
            <td>
                {% if value == '일' %}
                <font color="red">
                {{ value }}
                </font>
                {% else %}
                {{ value }}
                {% endif %}
            </td>
            {% endfor %}
        </tr>
        {% endif %}
        {% if user_list %}
        {% for user in user_list %}
        <tr>
            <td>
                {{ user.emp_name }}
            </td>
            {% for key, value in day_list.items %}
            <td>
                <input type="hidden" name="sch_{{user.id}}_{{key}}" id="sch_{{user.id}}_{{key}}"
                               value="">
                <div class="module_box" style="cursor: pointer;" id="insert_{{user.id}}_{{key}}" onclick="insert('{{user.id}}_{{key}}')"
                    {% for module in module_list %}
                    {% if module.id == form.d1.value|add:"0" %}
                    style="background-color: {{ module_colors|get_index:module.color }};"
                    {% endif %}
                    {% endfor %}>
                    {% for module in module_list %}
                    {% if module.id == form.d1.value|add:"0" %}
                        {% if module.cat == 'OFF' %}
                            -
                        {% else %}
                            {{ module.start_time }}
                            {{ module.end_time }}
                        {% endif %}
                    {% endif %}
                    {% endfor %}
                </div>
            </td>
            {% endfor %}
        </tr>
        {% endfor %}
        {% endif %}
    </table>
    </div>
</div>
</form>
{% endblock %}
{% block script %}
<script type="text/javascript">
function insert(target) {
    // target은 "user.id"_"일" 값임 ex) 1_1, 1_31,

    try {
        // 선택모듈의 module.id를 가져온다.
        const moduleIdSelected = document.querySelector("input[type='radio'][name='module']:checked").value;

        // 선택모듈을 가져온다.
        const moduleBoxSelected = document.getElementById("select"+moduleIdSelected);

        // 입력모듈을 가져와서, 내용 및 색상을 선택한 선택모듈의 것으로 세팅한다.
        const moduleBoxInsert = document.getElementById("insert_"+target);
        moduleBoxInsert.innerHTML = moduleBoxSelected.innerHTML;
        moduleBoxInsert.style.backgroundColor = moduleBoxSelected.style.backgroundColor;

        // DB에 저장하기 위해 선택모듈의 module.id를 해당 form element(hidden)에 세팅한다.
        const moduleInput = document.getElementById("sch_"+target);
        moduleInput.value = moduleIdSelected;
    } catch (e) {
        alert("상단 근무모듈을 먼저 선택하세요.");
        return;
    }
};
</script>
{% endblock %}