{% extends 'base.html' %}
{% load pybo_filter %}
{% block content %}
<div class="container my-3">
  <!-- 상단 필터 버튼 -->
  <div class="btn-group mb-3" role="group" aria-label="근태 지표 필터">
    <a href="{% url 'wtm:work_status' stand_ym %}"
       class="btn btn-sm {% if active_metric == 'ALL' %}btn-primary{% else %}btn-outline-primary{% endif %}">
      전체
    </a>
    <a href="{% url 'wtm:work_metric' 'LATE' stand_ym %}"
       class="btn btn-sm {% if active_metric == 'LATE' %}btn-primary{% else %}btn-outline-primary{% endif %}">
      지각
    </a>
    <a href="{% url 'wtm:work_metric' 'EARLY' stand_ym %}"
       class="btn btn-sm {% if active_metric == 'EARLY' %}btn-primary{% else %}btn-outline-primary{% endif %}">
      조퇴
    </a>
    <a href="{% url 'wtm:work_metric' 'OVERTIME' stand_ym %}"
       class="btn btn-sm {% if active_metric == 'OVERTIME' %}btn-primary{% else %}btn-outline-primary{% endif %}">
      연장근무
    </a>
    <a href="{% url 'wtm:work_metric' 'HOLIDAY' stand_ym %}"
       class="btn btn-sm {% if active_metric == 'HOLIDAY' %}btn-primary{% else %}btn-outline-primary{% endif %}">
      휴일근무
    </a>
  </div>

  <div class="row align-items-center mb-3">
    <div class="col fs-4 fw-semibold">근태현황 (월간)</div>
    <div class="col text-end">
      <a class="btn btn-light me-2" href="{% url 'wtm:work_status' prev_ym %}">◀</a>
      <input type="month" id="ym" class="form-control d-inline-block w-auto"
             value="{{ stand_ym|slice:'0:4' }}-{{ stand_ym|slice:'4:6' }}" onkeydown="return false">
      <a class="btn btn-light ms-2" href="{% url 'wtm:work_status' next_ym %}">▶</a>
    </div>
  </div>

<!--  <div class="alert alert-secondary py-2 small">-->
<!--    • 개인 속성의 “근태확인 제외”는 집계 제외 • 시간단위: hh:mm:ss-->
<!--  </div>-->

  <div class="table-responsive">
    <table class="table table-sm table-bordered align-middle text-center">
      <thead class="table-light">
        <tr>
          <th rowspan="2">부서</th>
          <th rowspan="2">직위</th>
          <th rowspan="2">성명</th>
          <th rowspan="2">오류<br>(일수)</th>
          <th colspan="2">지각</th>
          <th colspan="2">조퇴</th>
          <th colspan="2">초과근무</th>
          <th colspan="2">휴일근무</th>
        </tr>
        <tr>
          <th>횟수</th><th>시간</th>
          <th>횟수</th><th>시간</th>
          <th>횟수</th><th>시간</th>
          <th>횟수</th><th>시간</th>
        </tr>
      </thead>
      <tbody>
        {% for r in rows %}
        <tr>
          <td class="text-nowrap">{{ r.dept }}</td>
          <td class="text-nowrap">{{ r.position }}</td>
          <td class="text-nowrap">{{ r.emp_name }}</td>
          <td>{{ r.error_cnt|default:"" }}</td>

          <td>{{ r.late_cnt|default:"" }}</td>
          <td class="text-end">{{ r.late_sec|ss_to_hhmmss }}</td>

          <td>{{ r.early_cnt|default:"" }}</td>
          <td class="text-end">{{ r.early_sec|ss_to_hhmmss }}</td>

          <td>{{ r.overtime_cnt|default:"" }}</td>
          <td class="text-end">{{ r.overtime_sec|ss_to_hhmmss }}</td>

          <td>{{ r.holiday_cnt|default:"" }}</td>
          <td class="text-end">{{ r.holiday_sec|ss_to_hhmmss }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="12" class="py-5 text-muted">대상 직원이 없습니다.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<script>
  const ym = document.getElementById('ym');
  ym?.addEventListener('change', () => {
    const v = ym.value.replace('-', '');
    window.location.href = `/wtm/status/${v}/`;
  });
</script>
{% endblock %}