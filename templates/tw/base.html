{% load static %}
<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon"
      href="{% static 'favicon' %}{% if env_label != 'PROD' %}-{{ env_label|lower }}{% endif %}.png">
    <title>
        {% if env_label != "PROD" %}[{{ env_label }}] {% endif %}
        {% block title %}Medi HR - YOU&I 인사관리{% endblock %}
    </title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'tw/tailwind.css' %}">
    <script src="https://unpkg.com/htmx.org@1.9.12"></script>
    <style>
        .htmx-indicator {
            display: none;
        }
        .htmx-indicator.htmx-request {
            display: inline-flex;
        }
    </style>
</head>
<body class="min-h-screen bg-slate-50 text-slate-900">
    {% include "tw/navbar.html" %}
    <div class="min-h-screen bg-[radial-gradient(circle_at_top,_rgba(13,148,136,0.08),transparent_45%)] min-[1920px]:pl-60 flex flex-col">
        <main class="pt-20 flex-1">
            <div class="mx-auto w-full max-w-[1500px] px-4 pb-10 lg:px-6">
                {% block content %}{% endblock %}
            </div>
        </main>
        {% include "tw/footer.html" %}
    </div>

    <script>
        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie !== "") {
                var cookies = document.cookie.split(";");
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + "=")) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        document.body.addEventListener("htmx:configRequest", function (event) {
            event.detail.headers["X-CSRFToken"] = getCookie("csrftoken");
        });

        document.body.addEventListener("htmx:responseError", function (event) {
            var errorBox = null;
            if (event.target && event.target.querySelector) {
                errorBox = event.target.querySelector("[data-error-box]");
            }
            if (!errorBox) {
                errorBox = document.getElementById("meal-errors") || document.getElementById("meal-errors-table");
            }
            if (errorBox) {
                errorBox.textContent = event.detail.xhr.responseText || "요청 처리 중 오류가 발생했습니다.";
                errorBox.classList.remove("hidden");
            }
        });

        document.body.addEventListener("htmx:afterRequest", function (event) {
            var errorBox = null;
            if (event.target && event.target.querySelector) {
                errorBox = event.target.querySelector("[data-error-box]");
            }
            if (!errorBox) {
                errorBox = document.getElementById("meal-errors") || document.getElementById("meal-errors-table");
            }
            if (!errorBox) {
                return;
            }
            if (event.detail.xhr.status < 400) {
                errorBox.textContent = "";
                errorBox.classList.add("hidden");
            }
        });

        document.body.addEventListener("click", function (event) {
            var toggle = event.target.closest("[data-tw-toggle='mobile-nav']");
            if (!toggle) {
                return;
            }
            var targetId = toggle.getAttribute("data-target") || "tw-mobile-menu";
            var target = document.getElementById(targetId);
            if (!target) {
                return;
            }
            var isHidden = target.classList.toggle("hidden");
            toggle.setAttribute("aria-expanded", String(!isHidden));
        });
    </script>
    {% block extra_scripts %}{% endblock %}
</body>
</html>
